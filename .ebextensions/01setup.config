# http://docs.aws.amazon.com/elasticbeanstalk/latest/dg/create_deploy_Python_custom_container.html
# http://docs.aws.amazon.com/elasticbeanstalk/latest/dg/create_deploy_Python_django.html

packages:
  # [] installs newest version
  yum:
    libjpeg-turbo-devel: []
    freetype-devel: []
    zlib-devel: []
    lcms2-devel: []
    lcms2-utils: []
    libtiff-devel: []
    libwebp-devel: []


commands:
  00-setup-dirs:
    # create directories for loris cache etc.
    command: >
      for dir in tmp log cache cache-loris2 cache-links
        do
          mkdir -p "/home/wsgi/$dir"
      done
      chown -R wsgi:wsgi "/home/wsgi"


container_commands:
  00-setup-crontab:
    command: >
      printf "0 */4 * * * /usr/bin/flock -n /tmp/app_cache_clean.lockfile /opt/python/current/app/beanstalk_cache_clean.sh\n\n" | crontab -u wsgi -


option_settings:
  - namespace: aws:elasticbeanstalk:container:python
    option_name: WSGIPath
    value: loris2.wsgi.py
  - option_name: APP_WORK
    value: /home/wsgi
